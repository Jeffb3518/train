<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Find Your Train!</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
    integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <style>
  
    th{
      padding: 10px 70px;

    }
  </style>

    <!-- LINK TO FIREBASE GOES HERE -->
    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>

</head>
<body>

<div class="container">

    <br>

    <div class="jumbotron">
        <h1 class="text-center">Train Time!</h1>
    </div>

    <div class="row">
        <!-- Wells for displaying trains -->
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Current Train Schdule</h3>
                </div>
                <div class="panel-body">
                    <div id="list"></div>
                        <table>
                    
                            <tr>
                                <th>Train Name</th>
                                <th>Destination</th>
                                <th>Frequency</th>
                                <th>Next Arrival</th>
                                <th>Minutes Away</th>
                            </tr>
                        
                        </table>
                    </div>
                </div>
            </div>
        </div>
        

        <!-- Add Train Panel-->
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Add Train</h3>
                </div>
                <div class="panel-body">

                    <!-- Add Trains -->
                    <form role="form">
                        <div class="form-group">
                            <label for="text">Train Name:</label>
                            <input type="text" class="form-control" id="nameInput">
                        </div>
                        <div class="form-group">
                            <label for="text">Destination:</label>
                            <input type="text" class="form-control" id="destinationInput">
                        </div>
                        <div class="form-group">
                            <label for="text">First Train Time:</label>
                            <input type="number" class="form-control" id="arrivalInpunt">
                        </div>
                        <div class="form-group">
                            <label for="text">Frequency</label>
                            <input type="number" class="form-control" id="frequencyInput">
                        </div>
                        <button type="button" class="btn btn-default" id="addTrain">Submit</button>
                    </form>
                </div>
            </div>
        </div>
</div>
    


<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
<script type="text/javascript">

 // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBKfKXxnZvCqS2e0Au92EVlYfu8iae6nAM",
    authDomain: "train-time-80488.firebaseapp.com",
    databaseURL: "https://train-time-80488.firebaseio.com",
    storageBucket: "train-time-80488.appspot.com",
    messagingSenderId: "186434843376"
  };
  firebase.initializeApp(config);

  var database = firebase.database();

  //initial values
  var name = 0;
  var destination = "";
  var arrival = 0;
  var frequency = 0;

  $("#addTrain").on('click', function() {
       
    name = $("#nameInput").val().trim();
    destination = $("#destinationInput").val().trim();
    arrival = $("#arrivalInpunt").val().trim();
    frequency = parseInt($("#frequencyInput").val().trim());
        console.log(arrivalInpunt);

    database.ref().push({
        name: name,
        destination: destination,
        arrival: arrival,
        frequency: frequency
        // dateAdded: firebase.database.ServerValue.TIMESTAMP
    })
    return false;
  });

  database.ref().on("child_added", function (childSnapshot) {
        // Log everything that's coming out of snapshot
        console.log(childSnapshot.val().name);
        console.log(childSnapshot.val().destination);
        console.log(childSnapshot.val().arrival);
        console.log(childSnapshot.val().frequency);
        // console.log(childSnapshot.val().dateAdded);

  // database.ref().on("child_added", function (childAdded) {
  //   var name = childAdded.val().name;
  //   var destination = childAdded.val().destination;
  //   var arrival = childAdded.val().arrival;
  //   var frequency = childAdded.val().frequency;

    var tFrequency = 3;
    var firstTime = "03:00";

    var timeConverted = moment(firstTime, "HH:mm").subtract(1, "years");
    console.log(timeConverted);

    var time = moment ();
    console.log("CURRENT TIME : " + moment(time).format("hh:mm"));

    var diffTime = moment().diff(moment(timeConverted), "minutes");
    console.log("DIFFERENCE IN TIME: " + diffTime);

    var tRemainder = diffTime % tFrequency;
    console.log(tRemainder);

    var tMinutesTillTrain = tFrequency - tRemainder;
    console.log("MINUTES TILL TRAIN: " + tMinutesTillTrain);

    var nextTrain = moment().add(tMinutesTillTrain, "minutes");
    console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm A"));
    var nextTrainTime = moment(nextTrain).format("hh:mm A")

    var html = "<div id='list'>";
        html += "<span class='name'>Name: " + childSnapshot.val().name + "</span> ";
        html += "<span class='destination'>Destination: " + childSnapshot.val().destination + "</span> ";
        html += "<span class='arrival'>Arrival: " + childSnapshot.val().arrival + "</span> ";
        html += "<span class='frequency'>Frequency: " + childSnapshot.val().frequency + "</span>";
        html += "</div>";

        $('#list').append(html);

   
  }, function(errorObject){

  });

  database.ref().orderByChild("dateAdded").limitToLast(1)
            .on("child_added", function (snapshot) {
        // Change the HTML to reflect
        $("#nameInput").html(snapshot.val().name);
        $("#destinationInput").html(snapshot.val().destination);
        $("#arrivalInpunt").html(snapshot.val().arrival);
        $("#frequencyInput").html(snapshot.val().frequency);
    })

</script>
</body>
</html>